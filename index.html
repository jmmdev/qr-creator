<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
        <link rel="stylesheet" href="styles.css">
        <title>QR Creator</title>
    </head>
    <body>
        <header>
            
        </header>
        <div class="main-container">
            <div class="row">
                <div id="settings-container" class="settings-container col-md-7 col-lg-8">
                    <div class="settings-field enabled-field" onclick="showSettings(event)">
                        <i class="bi bi-link-45deg settings-field-icon"></i>
                        URL
                        <i class="bi bi-dash show-icon"></i>
                    </div>
                    <div id="url-settings" class="settings-content enabled-settings">
                        <div class="url-input">
                            <input id="url" type="text" placeholder="https://example.com" value="https://jmmdev.github.io/qr-creator" onkeyup="checkInputValue()" onkeydown="checkInputValue()" onkeypress="checkInputValue()"/>
                        </div>
                        <div class="file-text">
                            <a href="#">O sube un archivo de imagen</a>
                        </div>
                    </div>
                    <div class="settings-field disabled-field" onclick="showSettings(event)">
                        <i class="bi bi-square settings-field-icon"></i>
                        Marco
                        <i class="bi bi-plus show-icon"></i>
                    </div>
                    <div id="frame-settings" class="settings-content disabled-settings">
                    </div>
                    <div class="settings-field disabled-field" onclick="showSettings(event)">
                        <i class="bi bi-image settings-field-icon"></i>
                        Logo
                        <i class="bi bi-plus show-icon"></i>
                    </div>
                    <div id="logo-settings" class="settings-content disabled-settings">
                        <input type="file" id="my-file" name="my-file" style="display: none" accept="image/png, image/jpeg, image/jpg" onchange="fileUpload()">
                        <div class="logo-button">
                            <button id="logo-button" type="button" class="btn btn-secondary" disabled onclick="clickFileUpload()"><i class="bi bi-upload"></i> Elegir archivo</button>
                        </div>
                        <div id="logo-info" class="logo-info">
                            Ning√∫n archivo seleccionado
                        </div>
                        <div id="show-logo-container" class="show-logo-container">
                            <button id="show-logo" class="show-logo" type="button" onclick="doShowLogo()"><i class="bi bi-eye-slash-fill"></i></button>
                        </div>
                    </div>
                    <div class="settings-field disabled-field" onclick="showSettings(event)">
                        <i class="bi bi-palette settings-field-icon"></i>
                        Colores
                        <i class="bi bi-plus show-icon"></i>
                    </div>
                    <div class="settings-content disabled-settings">
                        TODO
                    </div>

                </div>
                <div class="qr-container col-md-5 col-lg-4">
                    <div id="qr-preview" class="qr-preview">
                        <div id="qr-frame" class="qr-preview__frame">
                            <div id="loader" class="loader"></div>
                            <div id="qr-logo" class="qr-logo"></div>
                            <div id="qr-placeholder" class="qr-placeholder">
                                <div style="width: 100%; text-align: center; color: #999999; opacity: 60%; font-size: 2px; font-weight: 600; position: absolute; top: 50%; transform: translateY(-50%);">PLACEHOLDER</div>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" fill="black" class="bi bi-qr-code" viewBox="0 0 16 16">
                                        <path d="M2 2h2v2H2V2Z"/>
                                        <path d="M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"/>
                                        <path d="M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"/>
                                        <path d="M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"/>
                                        <path d="M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"/>
                                    </svg>
                                </div>
                            <div id="qr-code" class="qr-code"></div>
                        </div>
                    </div>
                    <div class="save-buttons">
                        <button id="generate-button" type="button" class="btn btn-success" onclick="generateQR()">Generar QR</button>
                        <button id="download-button" type="button" class="btn btn-primary" disabled><i class="bi bi-download"></i> Descargar</button>
                    </div>
                </div>
            </div>
        </div>
    

        <script>
            var previewBorder = document.getElementById("qr-frame");
            var qrLogo = document.getElementById("qr-logo");
            var myFile = document.getElementById("my-file");
            var logoInfo = document.getElementById("logo-info");
            var showLogo = document.getElementById("show-logo-container");
            var lastPhoto = "";

            function clickFileUpload(){
                document.getElementById("my-file").click();
            }
            
            function fileUpload(){
                var photo = myFile.files[0];

                if(photo){
                    qrLogo.innerHTML = '<img src="' + URL.createObjectURL(photo) + '"/>';
                    qrLogo.style.display = "flex";
                    logoInfo.style.maxWidth = "40%";
                    logoInfo.innerHTML = photo.name;

                    lastPhoto = photo;

                    showLogo.style.display = "block";
                }

                document.activeElement.blur();
                console.log(document.activeElement);
            }
            </script>

            <script>
            function generateQR(){
                var placeholder = document.getElementById("qr-placeholder");
                var code = document.getElementById("qr-code");
                var previewFrame = document.getElementById("qr-frame");
                var loader = document.getElementById("loader");
                var logoButton = document.getElementById("logo-button");
                var frameStyle = getComputedStyle(previewFrame);
                var downloadButton = document.getElementById("download-button");

                var input = document.getElementById("url");
                var text = '';

                if(input.value !== ''){
                    downloadButton.disabled = true;
                    logoButton.disabled = true;

                    text = input.value;
                    code.innerHTML = "";

                    var qr = new QRCode(code, {
                        text: input.value,
                        width: 2000,
                        height: 2000,
                        colorDark : "#000000",
                        colorLight : "#ffffff",
                        correctLevel : QRCode.CorrectLevel.H
                    });

                    console.log(code.children[1]);

                    previewFrame.style.opacity = "50%";
                    loader.style.display = "block";

                    setTimeout(() => {
                        code.children[1].style.width = "100%";
                        previewFrame.style.opacity = "100%";
                        placeholder.style.display = "none";
                        loader.style.display = "none";
                        code.style.display = "block";
                        downloadButton.disabled = false;
                        logoButton.disabled = false;
                    }, 2000);
                }
            }
        </script>

        <script>
            var logoShown = false;
            function doShowLogo(){
                var qrLogo = document.getElementById("qr-logo");
                var showLogo = document.getElementById("show-logo");
                logoShown = !logoShown;
                
                if(logoShown){
                    qrLogo.style.display = "flex";
                    showLogo.innerHTML = '<i class="bi bi-eye-slash-fill">';
                }else{
                    qrLogo.style.display = "none";
                    showLogo.innerHTML = '<i class="bi bi-eye-fill">';
                }
            }
        </script>

        <script src="./app.js"></script>
        <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    </body>
</html>
